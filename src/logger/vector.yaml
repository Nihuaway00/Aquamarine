api:
  enabled: true

sources:
  docker:
    type: docker_logs
    exclude_containers:
      - logger

transforms:
  betterstack_transform:
    type: remap
    inputs:
      - docker
    source: |
      .dt = del(.timestamp)
  producer_filter:
    type: filter
    inputs: 
      - betterstack_transform
    condition: '.container_name == "web-producer"'
  executor_filter:
    type: filter
    inputs: 
      - betterstack_transform
    condition: '.container_name == "src-web-executor-1"'
  rabbitmq_filter:
    type: filter
    inputs: 
      - betterstack_transform
    condition: '.container_name == "rabbitmq-queue"'
  minio_filter:
    type: filter
    inputs: 
      - betterstack_transform
    condition: '.container_name == "minio-filestorage"'
  nginx_filter:
    type: filter
    inputs: 
      - betterstack_transform
    condition: '.container_name == "nginx"'

sinks:
  producer_logs:
    type: http
    inputs:
      - producer_filter
    uri: ${SINK_URI}
    encoding:
      codec: json
    auth:
      strategy: bearer
      token: ${PRODUCER_TOKEN}
  executor_logs:
    type: http
    inputs:
      - executor_filter
    uri: ${SINK_URI}
    encoding:
      codec: json
    auth:
      strategy: bearer
      token: ${EXECUTOR_TOKEN}
  rabbitmq_logs:
    type: http
    inputs:
      - rabbitmq_filter
    uri: ${SINK_URI}
    encoding:
      codec: json
    auth:
      strategy: bearer
      token: ${RABBITMQ_TOKEN}
  minio_logs:
    type: http
    inputs:
      - minio_filter
    uri: ${SINK_URI}
    encoding:
      codec: json
    auth:
      strategy: bearer
      token: ${MINIO_TOKEN}
  nginx_logs:
    type: http
    inputs:
      - nginx_filter
    uri: ${SINK_URI}
    encoding:
      codec: json
    auth:
      strategy: bearer
      token: ${NGINX_TOKEN}