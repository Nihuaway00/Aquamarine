# Aquamarine
Сервис для удобной работы с PDF файлами, поддерживающий большие объемы пользователей и предоставляющий базовые операции с PDF файлами. Пользователь может использовать все инструменты бесплатно без регистрации. Для администрирования будут предусмотрены специальные аккаунты.

## 1. Цели проекта:
1. Практика работы с новыми инструментами (NestJS, KnexJS, MySql, Swagger, NGINX, Jest)
2. Практика с уже знакомыми (RESTful API, Docker, JWT-auth, Github Actions)
3. Изучить развертывание (настройку арендованного сервера, балансировщика нагрузки и CI/CD)
4. Реализовать готовый к демонстрации продукт - сервис работы с PDF документами для удобного и быстрого повседневного использования

## 2. Функциональные требования
### MVP
#### Файлы
- Загрузка и скачивание файлов по одному (в зависимости от выбранного инструмента)
- Ограничение по типу файлов (в зависимости от выбранного инструмента)
- Проверка файла на повреждения
- Временное хранение файлов и фоновая обработка
- Генерация миниатюр

#### Работа с PDF
- объединить, разделить, удалить страницы, извлеч изображения

----
### Полная версия
#### Роли и права доступа
- Администратор
  - Просмотр логов и статистики
- Пользователь **без регистрации**
  - Использование инструментов

#### Работа с PDF
- Сжатие
- Конвертация в PDF (из JPEG, WORD, EXEL, POWERPOINT) и из PDF

#### Интерфейс
Web-интерфейс для использования сервиса

#### Логирование и статистика
- Логирование всех действий
- Предоставление статистики для администратора

## 3. Нефункциональные требования

### Обработка и хранение файлов
- Лимит размера одного файла: 50 мБайт
- Инструменты, принимающие несколько файлов, имеют ограничение в 10 файлов
- Загруженные и обработанные файлы должны хранится не более 24 часов
### Масштабируемость
- Сервис должен поддерживать запуск на нескольких серверах для обработки высокой нагрузки
- Логика приложения должна быть разделена на модули, чтобы в будущем их можно было выделить в микросервисы
### Безопасность
- Ограничение числа запросов (Rate Limiting) для предотвращения DDoS-атак.
### Удобство использования
- Уведомление пользователя о статусе обработки файла
### Тестирование
- Сервер должен быть протестирован на нагрузку до 1000 запросов в минуту
- Наличие тестов для проверки основных операций через Swagger/Postman
### Поддерживаемость
- Подробная Swagger-документация для API
- Код должен следовать стандартам (Eslint + Prettier)

## 4. Технические требования
### Технолоигческий стек
- Серверный фреймворк: NestJS
- БД: MySQL
- Хранилище файлов: MinIO
- Очереди задач: Redis + BullMQ
- Деплой: Docker, Github Actions, NGINX
### Интеграции
Библиотеки для работы с PDF: ???
### Архитектура
Монолитное приложение для MVP с возможностью переработки в микросервисы на следующем этапе

## 5. Пользовательские сценарии

### Сценарии для пользователя без регистрации
#### 1. Загрузка и обработка одного PDF-файла
1) Пользователь открывает веб-интерфейс сервиса.
2) Нажимает кнопку "Загрузить файл" и выбирает PDF-файл размером до 50 МБ.
3) В интерфейсе выбирает действие:
  - Например, "Удалить страницы".
4) Указывает диапазон страниц, которые нужно удалить (например, страницы 2-5).
5) Нажимает "Обработать".
6) После завершения обработки:
  - Отображается кнопка "Скачать файл".
  - Пользователь скачивает обработанный файл.


#### 2. Объединение нескольких PDF-файлов
1) Пользователь открывает веб-интерфейс.
2) Загружает два или более PDF-файла.
3) Выбирает действие "Объединить PDF".
4) Устанавливает порядок объединения (например, "файл 1 → файл 2").
5) Нажимает "Обработать".
6) После завершения объединения:
  - Отображается файл для скачивания.

#### 3. Массовое извлечение изображений
1) Пользователь открывает веб-интерфейс.
2) Загружает несколько PDF-файлов.
3) Выбирает действие "Извлечь изображения".
4) Нажимает "Обработать".
5) После завершения операции пользователь скачивает архив с извлеченными изображениями.

#### 4. Работа с поврежденным файлом
1) Пользователь пытается загрузить поврежденный PDF-файл.
2) Сервис отображает сообщение об ошибке: "Файл поврежден или не поддерживается".
3) Пользователь повторяет попытку с другим файлом.

----
### Сценарии для администратора

#### 5. Просмотр логов операций
1) Администратор авторизуется через интерфейс администратора, используя логин и пароль.
2) Переходит на страницу "Логи".
3) Видит список всех операций:
  - Время выполнения.
  - Тип операции.
  - Размер файлов.
  - Успешность выполнения.
4) Фильтрует логи по дате или типу операций.
#### 6. Просмотр статистики использования
1) Администратор заходит в раздел "Статистика".
2) Видит графики:
  - Количество обработанных файлов за день/неделю/месяц.
  - Среднее время выполнения операций.
  - Загруженность системы.
3) Использует эти данные для анализа и оптимизации системы.


----
### Сценарии полной версии
#### 7. Конвертация Word в PDF
1) Пользователь открывает веб-интерфейс.
2) Загружает документ Word.
3) Выбирает действие "Конвертировать в PDF".
4) Нажимает "Обработать".
5) После завершения операции пользователь скачивает PDF-файл.

#### 8. Сжатие PDF-файла
1) Пользователь загружает PDF-файл.
2) Выбирает действие "Сжать PDF".
3) Сервис предоставляет настройки сжатия (например, "Высокое качество" или "Максимальная компрессия").
4) Пользователь выбирает настройки и нажимает "Обработать".
5) После завершения обработки пользователь скачивает сжатый файл.

#### 9. Удаление временных файлов
1) Пользователь обрабатывает PDF и скачивает файл.
2) Через установленное время (например, 1 час) сервис автоматически удаляет файл из временного хранилища.
3) Если пользователь пытается повторно скачать файл после удаления, сервис отображает сообщение: "Срок хранения файла истек. Пожалуйста, повторите операцию".

#### 10. Генерация миниатюр
1) Пользователь загружает PDF с несколькими страницами.
2) Сервис генерирует миниатюры страниц и отображает их в интерфейсе.
3) Пользователь выбирает страницы для удаления или извлечения изображений.

----
### Сценарии ошибок и обработки исключений
#### 11. Ошибка загрузки файла
1) Пользователь пытается загрузить файл, который превышает лимит в 50 МБ.
2) Сервис отображает сообщение: "Файл превышает допустимый размер (50 МБ)".
#### 12. Сбой при обработке файла
1) Пользователь загружает файл и запускает операцию.
2) В процессе обработки возникает ошибка (например, из-за поврежденного файла).
3) Сервис логирует ошибку и уведомляет пользователя: "Ошибка обработки. Проверьте файл и повторите попытку".

## 6. Схема данных

## 7. Архитектура приложения

### Модули:

- CoreModule
  - Настройка всего приложения
  - Содержит все глобальные сервисы и зависимости
- AuthModule
  - Управляет доступом к защищенным ресурсам
  - Реализует роли и проверку токенов
- FileModule
  - Загрузка и скачивание файлов
  - Проверка типов и ограничения по размеру
  - Генерация миниатюр
  - Временное хранение и автоматическое удаление
- PdfProcessingModule
  - Операции, связанные с PDF
- AdminModule
  - Доступ к статистике и логам
- QueueModule
  - Управляет фоновыми задачами (обработка, загрузка и скачивание файлов)
- LoggingModule
  - Управление логами
- AnalyticsModule
  - Предоставляет аналитические данные
- DatabaseModule
  - Управляет подключением и взаимодействием с БД

## 8. Развертывание

## Тестирование

## Критерии завершенного проекта

## Этапы реализации
### **MVP**
---
##### **1. Проектирование**
- [ ] Определение функционала сервиса:
  - Подробное описание операций с PDF и файлов.
  - Уточнение лимитов и ограничений (например, 50 МБ, 10 файлов одновременно).
- [ ] Составление ТЗ:
  - Уточнение требований, пользовательских сценариев и структуры данных.
- [ ] Определение структуры API, БД и взаимодействия с MinIO:
  - Проектирование схем базы данных.
  - Составление спецификации API (основные эндпоинты).
  - Проработка взаимодействия с MinIO (загрузка, скачивание, удаление файлов).
- [ ] Прототипирование архитектуры приложения:
  - Разделение приложения на модули.
  - Определение взаимодействия модулей.

---

##### **2. Разработка API**
- [ ] Настройка проекта:
  - Инициализация проекта NestJS.
  - Настройка ESLint, Prettier, и других инструментов для соблюдения стандартов кода.
  - Интеграция Redis, MinIO, и других зависимостей.
- [ ] Реализация операций с PDF:
  - Реализация базовых операций (объединение, разделение, удаление страниц, извлечение изображений).
  - Поддержка массовой обработки файлов.
- [ ] Swagger-документация:
  - Описание всех эндпоинтов API.
  - Примеры запросов и ответов.

---

##### **3. Установка и настройка файлового хранилища**
- [ ] Установка MinIO:
  - Настройка локального и серверного хранилища.
  - Определение временных директорий и политик удаления.
- [ ] Интеграция MinIO с приложением:
  - Тестирование загрузки, скачивания и автоматического удаления файлов.

---

##### **4. Реализация очередей задач**
- [ ] Настройка Redis + BullMQ:
  - Установка Redis.
  - Реализация очередей для фоновой обработки файлов (например, сжатие или генерация миниатюр).
- [ ] Обработка задач:
  - Написание воркеров для выполнения долгих операций.

---

##### **5. Деплой MVP**
- [ ] Установка и настройка балансировщика нагрузки:
  - Настройка NGINX для распределения запросов.
- [ ] Развертывание на сервере:
  - Установка всех зависимостей (Node.js, Docker, MySQL, Redis, MinIO).
  - Настройка переменных окружения.
- [ ] Настройка CI/CD:
  - Настройка автоматического деплоя через GitHub Actions.
  - Проверка сборки и развертывания приложения.
- [ ] Тестирование на сервере:
  - Проведение тестов API (Swagger/Postman).
  - Проверка загрузки, обработки и скачивания файлов.

### **Полная версия**
---

##### **6. Расширение функционала**
- [ ] Реализация сжатия PDF:
  - Разработка сервиса для сжатия с выбором настроек (качество, компрессия).
- [ ] Конвертация в PDF и из PDF:
  - Интеграция библиотеки для конвертации (например, Word → PDF, PDF → JPEG).

---

##### **7. Реализация ролей и прав доступа**
- [ ] Авторизация через OAuth:
  - Добавление авторизации для административного интерфейса.
- [ ] Создание интерфейса администратора:
  - Реализация просмотра логов и статистики.

---

##### **8. Создание веб-интерфейса**
- [ ] Разработка веб-интерфейса для взаимодействия с сервисом:
  - Функции загрузки, настройки обработки и скачивания файлов.
  - Поддержка мобильных устройств.

---

##### **9. Добавление логов и аналитики**
- [ ] Логирование операций:
  - Запись операций в базу данных или файл.
- [ ] Реализация аналитики:
  - Графики и отчёты (например, через Prometheus/Grafana).

---

##### **10. Тестирование полной версии**
- [ ] Нагрузочное тестирование:
  - Проверка работы сервиса при высокой нагрузке (до 1000 запросов в минуту).
- [ ] Финальные интеграционные тесты:
  - Проверка всех функциональностей, включая работу очередей и API.

