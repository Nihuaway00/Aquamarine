# Aquamarine
Сервис для удобной работы с PDF файлами, поддерживающий большие объемы пользователей и предоставляющий базовые операции с PDF файлами. Пользователь может использовать все инструменты бесплатно без регистрации. Для администрирования будут предусмотрены специальные аккаунты.

## 1. Цели проекта:
1. Практика работы с новыми инструментами
2. Практика с уже знакомыми
3. Изучить развертывание (настройку арендованного сервера, балансировщика нагрузки и CI/CD)
4. Реализовать готовый к демонстрации продукт - сервис работы с PDF документами для удобного и быстрого повседневного использования

## 2. Функциональные требования
### MVP
#### Файлы
- Загрузка и скачивание файлов по одному (в зависимости от выбранного инструмента)
- Ограничение по типу файлов (в зависимости от выбранного инструмента)
- Проверка файла на повреждения
- Временное хранение файлов и фоновая обработка
- Генерация миниатюр

#### Работа с PDF
- объединить, разделить, удалить страницы, извлеч изображения

----
### Полная версия
#### Роли и права доступа
- Администратор
  - Просмотр логов и статистики
- Пользователь **без регистрации**
  - Использование инструментов

#### Работа с PDF
- Сжатие
- Конвертация в PDF (из JPEG, WORD, EXEL, POWERPOINT) и из PDF

#### Интерфейс
Web-интерфейс для использования сервиса

#### Логирование и статистика
- Логирование всех действий
- Предоставление статистики для администратора

## 3. Нефункциональные требования

### Обработка и хранение файлов
- Лимит размера одного файла: 50 мБайт
- Инструменты, принимающие несколько файлов, имеют ограничение в 10 файлов
- Загруженные и обработанные файлы должны хранится не более 24 часов
### Масштабируемость
- Сервис должен поддерживать запуск на нескольких серверах для обработки высокой нагрузки
- Логика приложения должна быть разделена на модули, чтобы в будущем их можно было выделить в микросервисы
### Безопасность
- Ограничение числа запросов (Rate Limiting) для предотвращения DDoS-атак.
### Удобство использования
- Уведомление пользователя о статусе обработки файла
### Тестирование
- Сервер должен быть протестирован на нагрузку до 1000 запросов в минуту
- Наличие тестов для проверки основных операций через Swagger/Postman
### Поддерживаемость
- Подробная Swagger-документация для API
- Код должен следовать стандартам (Eslint + Prettier)

## 4. Технические требования
### Технолоигческий стек
- Серверный фреймворк: NestJS
- БД: MySQL
- Хранилище файлов: MinIO
- Очереди задач: Redis + BullMQ
- Деплой: Docker, Github Actions, NGINX
### Интеграции
Библиотеки для работы с PDF: ???
### Архитектура
Монолитное приложение для MVP с возможностью переработки в микросервисы на следующем этапе

## Пользовательские сценарии

### 1. Загрузка и обработка одного PDF-файла
**Предыстория:** Пользователь хочет быстро удалить страницы из PDF-файла.  
**Шаги:**
1. Пользователь заходит на главную страницу веб-сервиса.
2. Нажимает кнопку **"Загрузить файл"**.
3. Выбирает PDF-файл размером до 50 МБ на своем устройстве.
4. После загрузки выбирает действие **"Удалить страницы"**.
5. Указывает страницы для удаления (например, 3 и 5-7).
6. Нажимает **"Обработать"**.
7. Дожидается завершения обработки (видит уведомление о статусе).
8. Скачивает обработанный PDF-файл, нажав кнопку **"Скачать файл"**.

---

### 2. Объединение нескольких PDF-файлов
**Предыстория:** Пользователь хочет объединить два документа в один.  
**Шаги:**
1. Пользователь открывает сервис в браузере.
2. Нажимает кнопку **"Загрузить файлы"**.
3. Выбирает два PDF-файла (каждый не превышает 50 МБ).
4. Выбирает опцию **"Объединить PDF"**.
5. Устанавливает порядок объединения (например, файл 1 → файл 2).
6. Нажимает **"Обработать"**.
7. После завершения обработки скачивает объединенный PDF-файл.

---

### 3. Извлечение изображений из PDF
**Предыстория:** Пользователь хочет извлечь изображения из нескольких PDF-файлов.  
**Шаги:**
1. Открывает интерфейс сервиса.
2. Загружает два или более PDF-файла.
3. Выбирает действие **"Извлечь изображения"**.
4. Нажимает **"Обработать"**.
5. Сервис уведомляет о завершении обработки.
6. Пользователь скачивает архив с извлеченными изображениями.

---

### 4. Обработка поврежденного файла
**Предыстория:** Пользователь случайно загрузил поврежденный файл.  
**Шаги:**
1. Пользователь загружает PDF-файл через интерфейс.
2. Сервис проверяет файл на повреждения.
3. Если файл поврежден, пользователь видит сообщение: **"Файл поврежден или не поддерживается"**.
4. Пользователь загружает другой файл для обработки.

---

### 5. Сжатие PDF-файла
**Предыстория:** Пользователь хочет уменьшить размер файла для отправки по почте.  
**Шаги:**
1. Пользователь загружает PDF-файл.
2. Выбирает действие **"Сжать PDF"**.
3. Выбирает настройки сжатия (например, "Максимальная компрессия").
4. Нажимает **"Обработать"**.
5. Получает обработанный файл для скачивания.

---

### 6. Конвертация Word в PDF
**Предыстория:** Пользователю нужно преобразовать документ Word в PDF.  
**Шаги:**
1. Пользователь загружает Word-документ через интерфейс.
2. Выбирает действие **"Конвертировать в PDF"**.
3. Нажимает **"Обработать"**.
4. После обработки скачивает готовый PDF-файл.

---

### 7. Генерация миниатюр страниц
**Предыстория:** Пользователь хочет увидеть миниатюры страниц перед удалением.  
**Шаги:**
1. Пользователь загружает PDF-файл.
2. Сервис автоматически генерирует миниатюры страниц.
3. Пользователь выбирает нужные страницы для удаления.
4. Нажимает **"Обработать"** и скачивает итоговый файл.

---

### 8. Просмотр логов (администратор)
**Предыстория:** Администратор хочет проанализировать ошибки в системе.  
**Шаги:**
1. Администратор авторизуется через административный интерфейс.
2. Заходит в раздел **"Логи"**.
3. Просматривает список операций:
   - Дата и время.
   - Тип операции.
   - Успешность.
4. При необходимости фильтрует логи по дате или типу операций.

---

### 9. Статистика использования (администратор)
**Предыстория:** Администратор анализирует использование сервиса.  
**Шаги:**
1. Администратор заходит в раздел **"Статистика"**.
2. Просматривает графики:
   - Количество обработанных файлов за неделю.
   - Среднее время выполнения операций.
   - Загруженность системы.

---

### 10. Обработка ошибки превышения лимита размера файла
**Предыстория:** Пользователь пытается загрузить файл больше 50 МБ.  
**Шаги:**
1. Пользователь загружает файл через интерфейс.
2. Сервис проверяет размер файла.
3. Если файл превышает 50 МБ, пользователь видит сообщение: **"Файл превышает допустимый размер (50 МБ)"**.

---

### 11. Автоматическое удаление временных файлов
**Предыстория:** Пользователь не скачал файл сразу после обработки.  
**Шаги:**
1. Пользователь завершает обработку файла и видит опцию для скачивания.
2. Через установленное время (например, 24 час) файл автоматически удаляется.
3. Пользователь не сможет его найти


## 6. Схема данных

## 7. Архитектура приложения

### Модули:
#### MVP
- CoreModule
  - Настройка всего приложения
  - Содержит все глобальные сервисы и зависимости
- FileModule
  - Загрузка и скачивание файлов
  - Проверка типов и ограничения по размеру
  - Генерация миниатюр
  - Временное хранение и автоматическое удаление 
- QueueModule
  - Управляет фоновыми задачами (обработка, загрузка и скачивание файлов) 
- PdfProcessingModule
  - Операции, связанные с PDF
----
#### Полная версия    
- AuthModule
  - Управляет доступом к защищенным ресурсам
  - Реализует роли и проверку токенов
- DatabaseModule
  - Управляет подключением и взаимодействием с БД
- AdminModule
  - Доступ к статистике и логам
- LoggingModule
  - Управление логами
- AnalyticsModule
  - Предоставляет аналитические данные

## 8. Развертывание

## Тестирование

## Критерии завершенного проекта

## Этапы реализации
### **MVP**
---
##### **1. Проектирование**
- [ ] Определение функционала сервиса:
  - Подробное описание операций с PDF и файлов.
  - Уточнение лимитов и ограничений (например, 50 МБ, 10 файлов одновременно).
- [ ] Составление ТЗ:
  - Уточнение требований, пользовательских сценариев и структуры данных.
- [ ] Определение структуры API, БД и взаимодействия с MinIO:
  - Проектирование схем базы данных.
  - Составление спецификации API (основные эндпоинты).
  - Проработка взаимодействия с MinIO (загрузка, скачивание, удаление файлов).
- [ ] Прототипирование архитектуры приложения:
  - Разделение приложения на модули.
  - Определение взаимодействия модулей.

---

##### **2. Разработка API**
- [ ] Настройка проекта:
  - Инициализация проекта NestJS.
  - Настройка ESLint, Prettier, и других инструментов для соблюдения стандартов кода.
  - Интеграция Redis, MinIO, и других зависимостей.
- [ ] Реализация операций с PDF:
  - Реализация базовых операций (объединение, разделение, удаление страниц, извлечение изображений).
  - Поддержка массовой обработки файлов.
- [ ] Swagger-документация:
  - Описание всех эндпоинтов API.
  - Примеры запросов и ответов.

---

##### **3. Установка и настройка файлового хранилища**
- [ ] Установка MinIO:
  - Настройка локального и серверного хранилища.
  - Определение временных директорий и политик удаления.
- [ ] Интеграция MinIO с приложением:
  - Тестирование загрузки, скачивания и автоматического удаления файлов.

---

##### **4. Реализация очередей задач**
- [ ] Настройка Redis + BullMQ:
  - Установка Redis.
  - Реализация очередей для фоновой обработки файлов (например, сжатие или генерация миниатюр).
- [ ] Обработка задач:
  - Написание воркеров для выполнения долгих операций.

---

##### **5. Деплой MVP**
- [ ] Установка и настройка балансировщика нагрузки:
  - Настройка NGINX для распределения запросов.
- [ ] Развертывание на сервере:
  - Установка всех зависимостей (Node.js, Docker, MySQL, Redis, MinIO).
  - Настройка переменных окружения.
- [ ] Настройка CI/CD:
  - Настройка автоматического деплоя через GitHub Actions.
  - Проверка сборки и развертывания приложения.
- [ ] Тестирование на сервере:
  - Проведение тестов API (Swagger/Postman).
  - Проверка загрузки, обработки и скачивания файлов.

### **Полная версия**
---

##### **6. Расширение функционала**
- [ ] Реализация сжатия PDF:
  - Разработка сервиса для сжатия с выбором настроек (качество, компрессия).
- [ ] Конвертация в PDF и из PDF:
  - Интеграция библиотеки для конвертации (например, Word → PDF, PDF → JPEG).

---

##### **7. Реализация ролей и прав доступа**
- [ ] Авторизация через OAuth:
  - Добавление авторизации для административного интерфейса.
- [ ] Создание интерфейса администратора:
  - Реализация просмотра логов и статистики.

---

##### **8. Создание веб-интерфейса**
- [ ] Разработка веб-интерфейса для взаимодействия с сервисом:
  - Функции загрузки, настройки обработки и скачивания файлов.
  - Поддержка мобильных устройств.

---

##### **9. Добавление логов и аналитики**
- [ ] Логирование операций:
  - Запись операций в базу данных или файл.
- [ ] Реализация аналитики:
  - Графики и отчёты (например, через Prometheus/Grafana).

---

##### **10. Тестирование полной версии**
- [ ] Нагрузочное тестирование:
  - Проверка работы сервиса при высокой нагрузке (до 1000 запросов в минуту).
- [ ] Финальные интеграционные тесты:
  - Проверка всех функциональностей, включая работу очередей и API.

